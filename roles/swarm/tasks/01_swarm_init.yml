---
- name: Make sure swarm is initialized on main manager node
  when: inventory_hostname == main_manager_node
  community.docker.docker_swarm:
    state: present
    advertise_addr: "{{ swarm_manager_address }}"
    listen_addr: "{{ swarm_manager_address }}"

- name: Log in to the container registry
  community.docker.docker_login:
    registry_url: ghcr.io
    username: "{{ secrets.ghcr.login }}"
    password: "{{ secrets.ghcr.token }}"

- name: Make sure /srv/env directory exists
  ansible.builtin.file:
    path: /srv/env
    state: directory
    owner: root
    group: root
    mode: "0750"
